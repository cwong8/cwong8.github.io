<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta charset="UTF-8">
  <title>cwong8.github.io</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <link rel="stylesheet" href="/css/normalize.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/cayman.css">
</head>

  <body>
    <section class="page-header">
      <h1 class="project-name"><a href="http://localhost:4000"><font color="white">Christopher Wong</font></a></h1>
      <a href="/about/" class="btn">About</a>
      <a href="/resume/Christopher.Wong.pdf" class="btn">Resume</a>
      <a href="mailto:cwong680@gmail.com" class="btn">Email me</a>
      <h2 class="page-name"><font color="white" size="22">Employee promotions and past employees</font></h2>
    </section>

    <section class="main-content">
      
      <h2 id="mysql-employees-sample-database">MySQL Employees Sample Database</h2>
<p>Using the MySQL Employees sample database to practice and learn SQL/MySQL before using Python and R to analyze queried data. Information about the database can be found at <a href="https://dev.mysql.com/doc/employee/en/">https://dev.mysql.com/doc/employee/en/</a>. The database can be downloaded at <a href="https://github.com/datacharmer/test_db">https://github.com/datacharmer/test_db</a>.</p>

<h3 id="tools-used">Tools used</h3>
<ul>
  <li>Package pandas for dataframes and functions such as read_sql_query</li>
  <li>Package numpy for general math functions</li>
  <li>Package MySQLdb to connect to MySQL</li>
  <li>Package scipy.stats for statistical testing</li>
  <li>Packages matplotlib and seaborn for plotting</li>
</ul>

<p>Creating a connection to MySQL, replace “yourusername” and “yourpassword” with the username/password to your MySQL.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="c1"># Server connection to MySQL:
</span><span class="kn">import</span> <span class="nn">MySQLdb</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span> <span class="s">"localhost"</span><span class="p">,</span>
                  <span class="n">user</span><span class="o">=</span><span class="s">"yourusername"</span><span class="p">,</span>
                  <span class="n">passwd</span><span class="o">=</span><span class="s">"yourpassword"</span><span class="p">,</span>
                  <span class="n">db</span><span class="o">=</span><span class="s">"employees"</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="employee-promotions">Employee promotions</h3>
<p>In this section, I answer some questions regarding promotions within this fictional company.</p>
<ol>
  <li>How many promotions were given? To how many employees?</li>
  <li>Has any employee been promoted more than once? What is the maximum times an employee has been promoted?</li>
  <li>How many employees were never promoted or left before being promoted?</li>
  <li>What is the average time before an employee is promoted? Is there noticeable discrimination based on gender or age?</li>
</ol>

<p>In MySQL I created a view named Promotions that I will reference but views cannot be created in Python:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE OR REPLACE VIEW Promotions AS
SELECT employees.emp_no, birth_date, first_name, last_name, gender, a.from_date AS hire_date, a.title AS hire_title, a.to_date AS promotion_date, b.title AS promoted_to, b.to_date AS end_date
FROM employees JOIN titles a ON employees.emp_no = a.emp_no JOIN titles b ON a.emp_no = b.emp_no
WHERE a.to_date = b.from_date AND a.title != b.title;
</code></pre></div></div>

<h5 id="1-how-many-promotions-were-given-to-how-many-employees">1. How many promotions were given? To how many employees?</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding all promotions
</span><span class="n">promotions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT employees.emp_no, birth_date, first_name, last_name, gender, a.from_date AS hire_date, a.title AS hire_title, a.to_date AS promotion_date, b.title AS promoted_to, b.to_date AS end_date
FROM employees JOIN titles a ON employees.emp_no = a.emp_no JOIN titles b ON a.emp_no = b.emp_no
WHERE a.to_date = b.from_date AND a.title != b.title;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">promotions</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>birth_date</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>gender</th>
      <th>hire_date</th>
      <th>hire_title</th>
      <th>promotion_date</th>
      <th>promoted_to</th>
      <th>end_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10004</td>
      <td>1954-05-01</td>
      <td>Chirstian</td>
      <td>Koblick</td>
      <td>M</td>
      <td>1986-12-01</td>
      <td>Engineer</td>
      <td>1995-12-01</td>
      <td>Senior Engineer</td>
      <td>9999-01-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10005</td>
      <td>1955-01-21</td>
      <td>Kyoichi</td>
      <td>Maliniak</td>
      <td>M</td>
      <td>1989-09-12</td>
      <td>Staff</td>
      <td>1996-09-12</td>
      <td>Senior Staff</td>
      <td>9999-01-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10007</td>
      <td>1957-05-23</td>
      <td>Tzvetan</td>
      <td>Zielinski</td>
      <td>F</td>
      <td>1989-02-10</td>
      <td>Staff</td>
      <td>1996-02-11</td>
      <td>Senior Staff</td>
      <td>9999-01-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10009</td>
      <td>1952-04-19</td>
      <td>Sumant</td>
      <td>Peac</td>
      <td>F</td>
      <td>1985-02-18</td>
      <td>Assistant Engineer</td>
      <td>1990-02-18</td>
      <td>Engineer</td>
      <td>1995-02-18</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10009</td>
      <td>1952-04-19</td>
      <td>Sumant</td>
      <td>Peac</td>
      <td>F</td>
      <td>1990-02-18</td>
      <td>Engineer</td>
      <td>1995-02-18</td>
      <td>Senior Engineer</td>
      <td>9999-01-01</td>
    </tr>
  </tbody>
</table>
</div>

<p>Notice how some employees have been promoted more than once (emp_no = 10009)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Number of promotions
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT COUNT(*)
FROM Promotions;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(*)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>143284</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Number of employees who received promotions
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT COUNT(DISTINCT(emp_no))
FROM Promotions;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(DISTINCT(emp_no))</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>140270</td>
    </tr>
  </tbody>
</table>
</div>

<p>We find that 143,294 promotions were given by this company to 140,270 employees. There are more promotions given than employees which leads into the next question.</p>

<h5 id="2-has-any-employee-been-promoted-more-than-once-what-is-the-maximum-times-an-employee-has-been-promoted">2. Has any employee been promoted more than once? What is the maximum times an employee has been promoted?</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding employees who have been promoted more than once
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT emp_no, COUNT(emp_no) AS times_promoted
FROM Promotions
GROUP BY emp_no
HAVING COUNT(*) &gt; 1
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>times_promoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10009</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10066</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10258</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10451</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10571</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding how many employees were promoted more than once
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT COUNT(*)
FROM
(SELECT emp_no, COUNT(emp_no) AS times_promoted
FROM Promotions
GROUP BY emp_no
HAVING COUNT(*) &gt; 1) AS a;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(*)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3014</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding the maximum number of promotions by a single employee
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT MAX(times_promoted)
FROM 
(SELECT emp_no, COUNT(emp_no) AS times_promoted
FROM Promotions
GROUP BY emp_no
HAVING COUNT(*) &gt; 1) AS a;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAX(times_promoted)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>

<p>We find that 3,014 employees have been promoted twice, and that no employees have ever been promoted three times.</p>

<h5 id="3-how-many-employees-were-never-promoted-or-left-before-being-promoted">3. How many employees were never promoted or left before being promoted?</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding all employees who have never been promoted or left before a promotion
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT employees.emp_no, birth_date, first_name, last_name, gender, hire_date, title, from_date, to_date
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING COUNT(employees.emp_no) = 1;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>birth_date</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>gender</th>
      <th>hire_date</th>
      <th>title</th>
      <th>from_date</th>
      <th>to_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10001</td>
      <td>1953-09-02</td>
      <td>Georgi</td>
      <td>Facello</td>
      <td>M</td>
      <td>1986-06-26</td>
      <td>Senior Engineer</td>
      <td>1986-06-26</td>
      <td>9999-01-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10002</td>
      <td>1964-06-02</td>
      <td>Bezalel</td>
      <td>Simmel</td>
      <td>F</td>
      <td>1985-11-21</td>
      <td>Staff</td>
      <td>1996-08-03</td>
      <td>9999-01-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10003</td>
      <td>1959-12-03</td>
      <td>Parto</td>
      <td>Bamford</td>
      <td>M</td>
      <td>1986-08-28</td>
      <td>Senior Engineer</td>
      <td>1995-12-03</td>
      <td>9999-01-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10006</td>
      <td>1953-04-20</td>
      <td>Anneke</td>
      <td>Preusig</td>
      <td>F</td>
      <td>1989-06-02</td>
      <td>Senior Engineer</td>
      <td>1990-08-05</td>
      <td>9999-01-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10008</td>
      <td>1958-02-19</td>
      <td>Saniya</td>
      <td>Kalloufi</td>
      <td>M</td>
      <td>1994-09-15</td>
      <td>Assistant Engineer</td>
      <td>1998-03-11</td>
      <td>2000-07-31</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding how many employees that have never been promoted or left before a promotion
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT COUNT(*)
FROM
(SELECT employees.emp_no, birth_date, first_name, last_name, gender, hire_date, title, from_date, to_date
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING COUNT(employees.emp_no) = 1) AS a;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(*)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>159754</td>
    </tr>
  </tbody>
</table>
</div>

<p>We find that 159,754 employees have never been promoted or left before a promotion.</p>

<h5 id="4-what-is-the-average-time-before-an-employee-is-promoted-is-there-noticeable-discrimination-based-on-gender-or-age">4. What is the average time before an employee is promoted? Is there noticeable discrimination based on gender or age?</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding the time before an employee is promoted
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT emp_no, gender, TIMESTAMPDIFF(DAY, hire_date, promotion_date) AS days_to_promotion
FROM promotions;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>gender</th>
      <th>days_to_promotion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10004</td>
      <td>M</td>
      <td>3287</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10005</td>
      <td>M</td>
      <td>2557</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10007</td>
      <td>F</td>
      <td>2557</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10009</td>
      <td>F</td>
      <td>1826</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10009</td>
      <td>F</td>
      <td>1826</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Grouping on gender and taking the average
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT gender, AVG(days_to_promotion)
FROM
(SELECT emp_no, gender, TIMESTAMPDIFF(DAY, hire_date, promotion_date) AS days_to_promotion
FROM promotions) AS a
GROUP BY gender;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>AVG(days_to_promotion)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>2473.6378</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>2469.7197</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let us visualize the distributions of days until promotion for males and females.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Group by gender
</span><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'gender'</span><span class="p">])</span>

<span class="c1"># Plot density plots
</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'F'</span><span class="p">)[</span><span class="s">'days_to_promotion'</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'M'</span><span class="p">)[</span><span class="s">'days_to_promotion'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x22ea5ff19b0&gt;
</code></pre></div></div>

<p><img src="output_25_1.png" alt="png" /></p>

<p>We see they have roughly the same distribution and similar peaks, leading me to conclude that there is no discrimination between genders. Something to note is that some employees have the same number of days before a promotion (e.g. emp_no = 10005 and 10007) and the number of days is very close to a multiple of days in a year (365 days approximately). This leads me to believe that employees are promoted on or near their hire dates, most likely at their yearly reviews.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding the age of employees when they were promoted
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT emp_no, gender, birth_date, promotion_date, TIMESTAMPDIFF(YEAR, birth_date, promotion_date) AS age_at_promotion
FROM promotions;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>gender</th>
      <th>birth_date</th>
      <th>promotion_date</th>
      <th>age_at_promotion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10004</td>
      <td>M</td>
      <td>1954-05-01</td>
      <td>1995-12-01</td>
      <td>41</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10005</td>
      <td>M</td>
      <td>1955-01-21</td>
      <td>1996-09-12</td>
      <td>41</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10007</td>
      <td>F</td>
      <td>1957-05-23</td>
      <td>1996-02-11</td>
      <td>38</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10009</td>
      <td>F</td>
      <td>1952-04-19</td>
      <td>1990-02-18</td>
      <td>37</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10009</td>
      <td>F</td>
      <td>1952-04-19</td>
      <td>1995-02-18</td>
      <td>42</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Grouping on gender and taking the average
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT gender, AVG(age_at_promotion)
FROM 
(SELECT emp_no, gender, birth_date, promotion_date, TIMESTAMPDIFF(YEAR, birth_date, promotion_date) AS age_at_promotion
FROM promotions) AS a
GROUP BY gender;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>AVG(age_at_promotion)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>38.1015</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>38.0952</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let us visualize the distributions of ages of promoted employees for males and females.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Group by gender
</span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'gender'</span><span class="p">])</span>

<span class="c1"># Plot density plots
</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'F'</span><span class="p">)[</span><span class="s">'age_at_promotion'</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'M'</span><span class="p">)[</span><span class="s">'age_at_promotion'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1a2a4e077b8&gt;
</code></pre></div></div>

<p><img src="output_30_1.png" alt="png" /></p>

<p>We see a much nicer and parametric distribution compared to the distribution of days until promotions. This bell curve distribution shape implies a Gaussian/normal distribution which we can test for. Assumption for a normality test such as the Shapiro-Wilk test are that observations are independent and identically distributed (iid) which is a fair assumption given observations are different employees for the most part. Some employees show up multiple times because they were promoted more than once (e.g. emp_no = 10009). We can obtain the first promotion for employees with multiple promotions by grouping on their employee id.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Group on emp_no to obtain the age at first promotion for all employees
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT emp_no, gender, birth_date, promotion_date, TIMESTAMPDIFF(YEAR, birth_date, promotion_date) AS age_at_promotion
FROM promotions
GROUP BY emp_no;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>gender</th>
      <th>birth_date</th>
      <th>promotion_date</th>
      <th>age_at_promotion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10004</td>
      <td>M</td>
      <td>1954-05-01</td>
      <td>1995-12-01</td>
      <td>41</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10005</td>
      <td>M</td>
      <td>1955-01-21</td>
      <td>1996-09-12</td>
      <td>41</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10007</td>
      <td>F</td>
      <td>1957-05-23</td>
      <td>1996-02-11</td>
      <td>38</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10009</td>
      <td>F</td>
      <td>1952-04-19</td>
      <td>1990-02-18</td>
      <td>37</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10012</td>
      <td>M</td>
      <td>1960-10-04</td>
      <td>2000-12-18</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Testing for normality
</span><span class="n">stat</span><span class="p">,</span> <span class="n">pF</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'gender'</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'F'</span><span class="p">)[</span><span class="s">'age_at_promotion'</span><span class="p">])</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">pM</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'gender'</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'M'</span><span class="p">)[</span><span class="s">'age_at_promotion'</span><span class="p">])</span>
<span class="p">{</span><span class="s">'gender'</span><span class="p">:</span> <span class="p">[</span><span class="s">'M'</span><span class="p">,</span> <span class="s">'F'</span><span class="p">],</span> <span class="s">'p-values'</span><span class="p">:</span> <span class="p">[</span><span class="n">pM</span><span class="p">,</span> <span class="n">pF</span><span class="p">]}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'gender': ['M', 'F'], 'p-values': [0.0, 0.0]}
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Quantile-quantile (qq) plot of the residuals
</span><span class="n">res</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">'F'</span><span class="p">)[</span><span class="s">'age_at_promotion'</span><span class="p">],</span> <span class="n">plot</span> <span class="o">=</span> <span class="n">plt</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="output_34_0.png" alt="png" /></p>

<p>We see that our p-values for both genders is 0 so we reject our null hypothesis that the distribution is normal and conclude that our distribution is not Gaussian/normal. We can see from the above qq-plot that the tails of our distribution are non-existent. This means the company is not promoting (or hiring) anyone who is under a minimum age or above a maximum age (i.e. they do not promote (or hire) teenagers or people close to retirement age).</p>

<h3 id="past-employees">Past employees</h3>
<p>Let’s take a look at the past employees at this company.</p>
<ol>
  <li>How many past employees does this company have?</li>
  <li>Find the ages of new hires. What is the average hire age? Plot the distribution.</li>
  <li>Find the ages of employees when they left the company. What is the average age of employees leaving the company? Plot the distribution.</li>
  <li>Combine the previous two questions to find the time spent at the company by past employees. Any interesting observations?</li>
</ol>

<h5 id="1-how-many-past-employees-does-this-company-have">1. How many past employees does this company have?</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding employees who have left the company. Current employees have to_date set to '9999-01-01'
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT employees.*, to_date
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING MAX(to_date) &lt; DATE '9999-01-01';
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>birth_date</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>gender</th>
      <th>hire_date</th>
      <th>to_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10008</td>
      <td>1958-02-19</td>
      <td>Saniya</td>
      <td>Kalloufi</td>
      <td>M</td>
      <td>1994-09-15</td>
      <td>2000-07-31</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10011</td>
      <td>1953-11-07</td>
      <td>Mary</td>
      <td>Sluis</td>
      <td>F</td>
      <td>1990-01-22</td>
      <td>1996-11-09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10015</td>
      <td>1959-08-19</td>
      <td>Guoxiang</td>
      <td>Nooteboom</td>
      <td>M</td>
      <td>1987-07-02</td>
      <td>1993-08-22</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10021</td>
      <td>1960-02-20</td>
      <td>Ramzi</td>
      <td>Erde</td>
      <td>M</td>
      <td>1988-02-10</td>
      <td>2002-07-15</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10025</td>
      <td>1958-10-31</td>
      <td>Prasadram</td>
      <td>Heyers</td>
      <td>M</td>
      <td>1987-08-17</td>
      <td>1997-10-15</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding how many past employees there are
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT COUNT(DISTINCT(emp_no))
FROM
(SELECT employees.*, to_date
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING MAX(to_date) &lt; DATE '9999-01-01') AS a;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(DISTINCT(emp_no))</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>59900</td>
    </tr>
  </tbody>
</table>
</div>

<p>We find that 59,900 employees have left this company.</p>

<h5 id="2-find-the-ages-of-new-hires-what-is-the-average-hire-age-plot-the-distribution">2. Find the ages of new hires. What is the average hire age? Plot the distribution.</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding the hire age of all employees
</span><span class="n">new_hire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT employees.emp_no, birth_date, first_name, last_name, gender, hire_date, TIMESTAMPDIFF(YEAR, birth_date, hire_date) AS hire_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>birth_date</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>gender</th>
      <th>hire_date</th>
      <th>to_date</th>
      <th>leaving_age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10008</td>
      <td>1958-02-19</td>
      <td>Saniya</td>
      <td>Kalloufi</td>
      <td>M</td>
      <td>1994-09-15</td>
      <td>2000-07-31</td>
      <td>42</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10011</td>
      <td>1953-11-07</td>
      <td>Mary</td>
      <td>Sluis</td>
      <td>F</td>
      <td>1990-01-22</td>
      <td>1996-11-09</td>
      <td>43</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10015</td>
      <td>1959-08-19</td>
      <td>Guoxiang</td>
      <td>Nooteboom</td>
      <td>M</td>
      <td>1987-07-02</td>
      <td>1993-08-22</td>
      <td>34</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10021</td>
      <td>1960-02-20</td>
      <td>Ramzi</td>
      <td>Erde</td>
      <td>M</td>
      <td>1988-02-10</td>
      <td>2002-07-15</td>
      <td>42</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10025</td>
      <td>1958-10-31</td>
      <td>Prasadram</td>
      <td>Heyers</td>
      <td>M</td>
      <td>1987-08-17</td>
      <td>1997-10-15</td>
      <td>38</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding the average hire age
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT AVG(hire_age)
FROM
(SELECT employees.emp_no, birth_date, first_name, last_name, gender, hire_date, TIMESTAMPDIFF(YEAR, birth_date, hire_date) AS hire_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no) AS a;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AVG(hire_age)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30.9972</td>
    </tr>
  </tbody>
</table>
</div>

<p>We find that employees are hired at an average age of approximately 31 years old.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Plot the distribution of ages for new hires
</span><span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">new_hire</span><span class="p">[</span><span class="s">'hire_age'</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">new_hire</span><span class="p">[</span><span class="s">'hire_age'</span><span class="p">])</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_hire</span><span class="p">[</span><span class="s">'hire_age'</span><span class="p">])))</span>
</code></pre></div></div>

<p><img src="output_45_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">new_hire</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(array([ 1461.,  4410.,  7059.,  9319., 11666., 14004., 15477., 17389.,
        18849., 19995., 20882., 21984., 22357., 21700., 18577., 16190.,
        13483., 11326.,  9188.,  7339.,  5765.,  4323.,  3067.,  2037.,
         1266.,   631.,   280.]),
 array([20., 21., 22., 23., 24., 25., 26., 27., 28., 29., 30., 31., 32.,
        33., 34., 35., 36., 37., 38., 39., 40., 41., 42., 43., 44., 45.,
        46., 47.]),
 &lt;a list of 27 Patch objects&gt;)
</code></pre></div></div>

<h5 id="3-find-the-ages-of-employees-when-they-left-the-company-what-is-the-average-age-of-employees-leaving-the-company-plot-the-distribution">3. Find the ages of employees when they left the company. What is the average age of employees leaving the company? Plot the distribution.</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding the age of employees when they left the company
</span><span class="n">past_employees</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT employees.*, to_date, TIMESTAMPDIFF(YEAR, birth_date, to_date) AS leaving_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING MAX(to_date) &lt; '9999-01-01';
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>birth_date</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>gender</th>
      <th>hire_date</th>
      <th>to_date</th>
      <th>leaving_age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10008</td>
      <td>1958-02-19</td>
      <td>Saniya</td>
      <td>Kalloufi</td>
      <td>M</td>
      <td>1994-09-15</td>
      <td>2000-07-31</td>
      <td>42</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10011</td>
      <td>1953-11-07</td>
      <td>Mary</td>
      <td>Sluis</td>
      <td>F</td>
      <td>1990-01-22</td>
      <td>1996-11-09</td>
      <td>43</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10015</td>
      <td>1959-08-19</td>
      <td>Guoxiang</td>
      <td>Nooteboom</td>
      <td>M</td>
      <td>1987-07-02</td>
      <td>1993-08-22</td>
      <td>34</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10021</td>
      <td>1960-02-20</td>
      <td>Ramzi</td>
      <td>Erde</td>
      <td>M</td>
      <td>1988-02-10</td>
      <td>2002-07-15</td>
      <td>42</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10025</td>
      <td>1958-10-31</td>
      <td>Prasadram</td>
      <td>Heyers</td>
      <td>M</td>
      <td>1987-08-17</td>
      <td>1997-10-15</td>
      <td>38</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding the average age of employees who left the company
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT AVG(leaving_age)
FROM
(SELECT employees.*, to_date, TIMESTAMPDIFF(YEAR, birth_date, to_date) AS leaving_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING MAX(to_date) &lt; '9999-01-01') AS a;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AVG(leaving_age)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>37.9825</td>
    </tr>
  </tbody>
</table>
</div>

<p>We find that on average employees leave when they are approximately 38 years old.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Plot the distribution of ages for employees who have left
</span><span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">past_employees</span><span class="p">[</span><span class="s">'leaving_age'</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">past_employees</span><span class="p">[</span><span class="s">'leaving_age'</span><span class="p">])</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">past_employees</span><span class="p">[</span><span class="s">'leaving_age'</span><span class="p">])))</span>
</code></pre></div></div>

<p><img src="output_51_0.png" alt="png" /></p>

<p>Let’s take a look at the distribution of ages for new and past employees.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Both distributions
</span><span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">new_hire</span><span class="p">[</span><span class="s">'hire_age'</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">new_hire</span><span class="p">[</span><span class="s">'hire_age'</span><span class="p">])</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">new_hire</span><span class="p">[</span><span class="s">'hire_age'</span><span class="p">])))</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">past_employees</span><span class="p">[</span><span class="s">'leaving_age'</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">past_employees</span><span class="p">[</span><span class="s">'leaving_age'</span><span class="p">])</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">past_employees</span><span class="p">[</span><span class="s">'leaving_age'</span><span class="p">])))</span>
</code></pre></div></div>

<p><img src="output_53_0.png" alt="png" /></p>

<p>We see that there are a lot more new hires compared to employees leaving the company. This could indicate that the company has grown significantly.</p>

<h5 id="4-combine-the-previous-two-questions-to-find-the-time-spent-at-the-company-by-past-employees-any-interesting-observations">4. Combine the previous two questions to find the time spent at the company by past employees. Any interesting observations?</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Finding past employees of this company and their ages at hire and their last day
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT a.*, b.to_date, b.leaving_age, CONCAT(TIMESTAMPDIFF(YEAR, a.hire_date, b.to_date), ' years, ', MOD(TIMESTAMPDIFF(MONTH, a.hire_date, b.to_date), 12), ' months') AS time_at_company, TIMESTAMPDIFF(DAY, a.hire_date, b.to_date) AS company_days
FROM
(SELECT employees.emp_no, birth_date, first_name, last_name, gender, hire_date, TIMESTAMPDIFF(YEAR, birth_date, hire_date) AS hire_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no) AS a
INNER JOIN
(SELECT employees.*, from_date, to_date, TIMESTAMPDIFF(YEAR, birth_date, to_date) AS leaving_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING MAX(to_date) &lt; '9999-01-01') AS b ON a.emp_no = b.emp_no;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>emp_no</th>
      <th>birth_date</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>gender</th>
      <th>hire_date</th>
      <th>hire_age</th>
      <th>to_date</th>
      <th>leaving_age</th>
      <th>time_at_company</th>
      <th>company_days</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10008</td>
      <td>1958-02-19</td>
      <td>Saniya</td>
      <td>Kalloufi</td>
      <td>M</td>
      <td>1994-09-15</td>
      <td>36</td>
      <td>2000-07-31</td>
      <td>42</td>
      <td>5 years, 10 months</td>
      <td>2146</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10011</td>
      <td>1953-11-07</td>
      <td>Mary</td>
      <td>Sluis</td>
      <td>F</td>
      <td>1990-01-22</td>
      <td>36</td>
      <td>1996-11-09</td>
      <td>43</td>
      <td>6 years, 9 months</td>
      <td>2483</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10015</td>
      <td>1959-08-19</td>
      <td>Guoxiang</td>
      <td>Nooteboom</td>
      <td>M</td>
      <td>1987-07-02</td>
      <td>27</td>
      <td>1993-08-22</td>
      <td>34</td>
      <td>6 years, 1 months</td>
      <td>2243</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10021</td>
      <td>1960-02-20</td>
      <td>Ramzi</td>
      <td>Erde</td>
      <td>M</td>
      <td>1988-02-10</td>
      <td>27</td>
      <td>2002-07-15</td>
      <td>42</td>
      <td>14 years, 5 months</td>
      <td>5269</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10025</td>
      <td>1958-10-31</td>
      <td>Prasadram</td>
      <td>Heyers</td>
      <td>M</td>
      <td>1987-08-17</td>
      <td>28</td>
      <td>1997-10-15</td>
      <td>38</td>
      <td>10 years, 1 months</td>
      <td>3712</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let’s take a look at the distribution of time past employees have worked at the company.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Plotting the distribution with a line at the peak
</span><span class="n">p</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'company_days'</span><span class="p">])</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="output_58_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Summary statistics on days spent at the company
</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s">"""
SELECT MIN(company_days), MAX(company_days), AVG(company_days)
FROM
(SELECT a.*, b.to_date, b.leaving_age, CONCAT(TIMESTAMPDIFF(YEAR, a.hire_date, b.to_date), ' years, ', MOD(TIMESTAMPDIFF(MONTH, a.hire_date, b.to_date), 12), ' months') AS time_at_company, TIMESTAMPDIFF(DAY, a.hire_date, b.to_date) AS company_days
FROM
(SELECT employees.emp_no, birth_date, first_name, last_name, gender, hire_date, TIMESTAMPDIFF(YEAR, birth_date, hire_date) AS hire_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no) AS a
INNER JOIN
(SELECT employees.*, from_date, to_date, TIMESTAMPDIFF(YEAR, birth_date, to_date) AS leaving_age
FROM employees JOIN titles ON employees.emp_no = titles.emp_no
GROUP BY employees.emp_no
HAVING MAX(to_date) &lt; '9999-01-01') AS b ON a.emp_no = b.emp_no) AS c;
"""</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MIN(company_days)</th>
      <th>MAX(company_days)</th>
      <th>AVG(company_days)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>6388</td>
      <td>2555.3828</td>
    </tr>
  </tbody>
</table>
</div>

<p>We see that peak density occurs at approximately 1880 days. On average employees spend approximately 2555 days working at the company with the maximum being 6388 days (about 17 years, 5 months). Some employees have worked less than a full day.</p>


      <footer class="site-footer">
  <span class="site-footer-owner"><a href="http://localhost:4000">cwong8.github.io</a> is maintained by <a href="https://github.com/cwong8">Christopher Wong</a>.</span>
  <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
</footer>


    </section>

  </body>
</html>
